<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../cells-radio-tabs.html">
</head>

<body>
  <test-fixture id="default">
    <template>
      <cells-radio-tabs options='["uno", "dos"]'></cells-radio-tabs>
      <cells-radio-tabs options='["uno", "dos"]'></cells-radio-tabs>
    </template>
  </test-fixture>

  <test-fixture id="icons">
    <template>
      <cells-radio-tabs options='[{"icon": "any", "label": "One"}, {"icon": "uuu", "label": "Two"}]' icon-size="18"></cells-radio-tabs>
    </template>
  </test-fixture>

  <script>
    suite('<cells-radio-tabs>', function() {
      var el;

      setup(function() {
        el = fixture('default')[0];
      });

      test('prints the same number of items as options.length property', function() {
        assert.equal(el.$.options.items.length, el.options.length);
      });

      test('sets an unique input name for each component instance', function(done) {
        var el2 = fixture('default')[1];

        flush(function() {
          var nameInstance1 = Polymer.dom(el.root).querySelector('input').getAttribute('name');
          var nameInstance2 = Polymer.dom(el2.root).querySelector('input').getAttribute('name');
          assert.notEqual(nameInstance1, nameInstance2);
          done();
        });
      });

      test('sets the selected option index as selected (checked)', function(done) {
        el.selected = 1;
        flush(function() {
          var secondOption = Polymer.dom(el.root).querySelectorAll('input')[el.selected];
          assert.isTrue(secondOption.checked);
          done();
        });
      });

      test('sets the indicator width as 100% / options.length', function() {
        flush(function(done) {
          el.addEventListener('cells-radio-tabs-styles-updated', function(e) {
            assert.equal(e.detail.itemWidth, '50%', 'Event detail contains the new itemWidth');
            assert.equal(el.getComputedStyleValue('--radio-tabs-item-width'), '50%');
            done();
          });
        });
      });

      test('translates the indicator in the X axis 100% * selected index', function() {
        el.options = [1,2,3];
        el.selected = 2;
        assert.equal(el.$.indicator.style.transform, `translateX(calc(${100 * el.selected}%))`);
      });

      test('does not translate the indicator if the selected value is greater than options.length or lower than zero', function() {
        var currentTransformStyle = window.getComputedStyle(el.$.indicator).transform;
        el.selected = 2;
        assert.equal(window.getComputedStyle(el.$.indicator).transform, currentTransformStyle);
        el.selected = -1;
        assert.equal(window.getComputedStyle(el.$.indicator).transform, currentTransformStyle);
      });

      test('sets selected property after changing selected option', function(done) {
        flush(function() {
          var secondOption = Polymer.dom(el.root).querySelectorAll('label')[1];
          secondOption.click();
          assert.equal(el.selected, 1);
          done();
        });
      });

      test('selected property is set as notifiable', function() {
        var spy = sinon.spy();
        el.addEventListener('selected-changed', spy);
        el.selected = 1;
        assert.isTrue(spy.calledOnce);
      });

      test('sets option as text label', function(done) {
        flush(function() {
          var firstLabel = Polymer.dom(el.root).querySelector('.label');
          var firstObjLabel = Polymer.dom(el.root).querySelectorAll('.label')[1];
          assert.isTrue(firstObjLabel.hidden, 'label for item with label key is hidden');
          assert.equal(el.options[0], firstLabel.innerHTML);
          done();
        });
      });

      test('icon is hidden', function(done) {
        flush(function() {
          var firstIcon = Polymer.dom(el.root).querySelector('.icon');
          assert.isTrue(firstIcon.hidden);
          done();
        });
      });
    });

    suite('With icons (objects as options)', function() {
      var el;
      var firstLabel;
      var firstSimpleLabel;
      var firstIcon;

      setup(function(done) {
        el = fixture('icons');

        flush(function() {
          firstSimpleLabel = Polymer.dom(el.root).querySelector('.label');
          firstLabel = Polymer.dom(el.root).querySelectorAll('.label')[1];
          firstIcon = Polymer.dom(el.root).querySelector('.icon');
          done();
        });
      });

      test('sets option.label as text label', function() {
        assert.isTrue(firstSimpleLabel.hidden, 'simple label is hidden');
        assert.equal(el.options[0].label, firstLabel.innerHTML);
      });

      test('icon is not hidden if option.icon is provided', function() {
        assert.isFalse(firstIcon.hidden);
      });

      test('iron-icon icon property is set as option.icon', function() {
        assert.equal(firstIcon.icon, el.options[0].icon);
      });

      test('icon has width and height equal to iconSize', function() {
        el.iconSize = 20;
        assert.equal(firstIcon.getComputedStyleValue('width'), el.iconSize + 'px');
      });
    });
  </script>
</body>

</html>
